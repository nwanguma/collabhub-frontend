{"version":3,"file":"useFollow.js","sourceRoot":"/","sources":["app/hooks/useFollow.ts"],"names":[],"mappings":";;;AAAA,iCAAiC;AACjC,6CAAqE;AACrE,gDAA4C;AAC5C,uDAAoD;AAGpD,yDAG+B;AAC/B,+BAAuE;AACvE,qDAAuD;AAEvD,+CAAgE;AAChE,+CAA0D;AAMnD,MAAM,SAAS,GAAG,CAAC,gBAA6B,EAAE,EAAE;IACzD,MAAM,MAAM,GAAG,IAAA,sBAAS,GAAE,CAAC;IAC3B,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,yBAAW,EAAC,CAAC,KAAgB,EAAE,EAAE,CAAC,CAAC;QAC3D,aAAa,EAAE,IAAA,mCAAuB,EAAC,KAAK,CAAC;KAC9C,CAAC,CAAC,CAAC;IACJ,MAAM,QAAQ,GAAG,IAAA,yBAAW,GAAe,CAAC;IAC5C,MAAM,CAAC,YAAY,EAAE,eAAe,CAAC,GAAG,IAAA,gBAAQ,EAAe,EAAE,CAAC,CAAC;IACnE,MAAM,cAAc,GAAG,IAAA,yBAAW,EAAC;QACjC,UAAU,EAAE,CAAC,SAAiB,EAAE,EAAE,CAAC,IAAA,gBAAU,EAAC,SAAS,CAAC;QACxD,SAAS,EAAE,CAAC,IAAI,EAAE,SAAS,EAAE,EAAE;YAC7B,eAAe,CAAC,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;gBAC9B,GAAG,SAAS;gBACZ,CAAC,SAAS,CAAC,EAAE,IAAI;aAClB,CAAC,CAAC,CAAC;YAEJ,QAAQ,CAAC,IAAA,8BAAgB,GAAE,CAAC,CAAC;QAC/B,CAAC;QACD,OAAO,EAAE,CAAC,KAAkB,EAAE,EAAE;YAC9B,IAAA,iCAAyB,EAAC,KAAK,CAAC,CAAC;QACnC,CAAC;KACF,CAAC,CAAC;IACH,MAAM,gBAAgB,GAAG,IAAA,yBAAW,EAAC;QACnC,UAAU,EAAE,CAAC,SAAiB,EAAE,EAAE,CAAC,IAAA,kBAAY,EAAC,SAAS,CAAC;QAC1D,SAAS,EAAE,CAAC,IAAI,EAAE,SAAS,EAAE,EAAE;YAC7B,eAAe,CAAC,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;gBAC9B,GAAG,SAAS;gBACZ,CAAC,SAAS,CAAC,EAAE,KAAK;aACnB,CAAC,CAAC,CAAC;YAEJ,QAAQ,CAAC,IAAA,8BAAgB,GAAE,CAAC,CAAC;QAC/B,CAAC;QACD,OAAO,EAAE,CAAC,KAAkB,EAAE,EAAE;YAC9B,IAAA,iCAAyB,EAAC,KAAK,CAAC,CAAC;QACnC,CAAC;KACF,CAAC,CAAC;IACH,MAAM,6BAA6B,GAAG,IAAA,yBAAW,EAAC;QAChD,UAAU,EAAE,CAAC,WAAmB,EAAE,EAAE,CAAC,IAAA,0BAAoB,EAAC,WAAW,CAAC;QACtE,SAAS,EAAE,CAAC,IAAI,EAAE,EAAE;YAClB,MAAM,sBAAsB,GAAG,aAAa,CAAC,IAAI,CAAC,CAAC,YAAY,EAAE,EAAE;gBACjE,OAAO,YAAY,CAAC,EAAE,KAAK,IAAI,CAAC,EAAE,CAAC;YACrC,CAAC,CAAC,CAAC;YAEH,IAAI,sBAAsB,EAAE,CAAC;gBAC3B,QAAQ,CAAC,IAAA,qCAAqB,EAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;YAC3C,CAAC;iBAAM,CAAC;gBACN,QAAQ,CAAC,IAAA,kCAAkB,EAAC,IAAI,CAAC,CAAC,CAAC;YACrC,CAAC;YAED,UAAU,CAAC,GAAG,EAAE;gBACd,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;YACrC,CAAC,EAAE,IAAI,CAAC,CAAC;QACX,CAAC;QACD,OAAO,EAAE,CAAC,KAAkB,EAAE,EAAE;YAC9B,IAAA,iCAAyB,EAAC,KAAK,CAAC,CAAC;QACnC,CAAC;QACD,SAAS,EAAE,GAAG,EAAE;YACd,gBAAgB,IAAI,gBAAgB,EAAE,CAAC;QACzC,CAAC;KACF,CAAC,CAAC;IAEH,MAAM,YAAY,GAAG,CAAC,SAAiB,EAAE,EAAE;QACzC,cAAc,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;IACnC,CAAC,CAAC;IAEF,MAAM,cAAc,GAAG,CAAC,SAAiB,EAAE,EAAE;QAC3C,gBAAgB,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;IACrC,CAAC,CAAC;IAEF,MAAM,2BAA2B,GAAG,CAAC,WAAmB,EAAE,EAAE;QAC1D,6BAA6B,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;IACpD,CAAC,CAAC;IAEF,OAAO;QACL,2BAA2B;QAC3B,YAAY;QACZ,cAAc;QACd,YAAY;KACb,CAAC;AACJ,CAAC,CAAC;AA9EW,QAAA,SAAS,aA8EpB","sourcesContent":["import { useState } from \"react\";\nimport { shallowEqual, useDispatch, useSelector } from \"react-redux\";\nimport { useRouter } from \"next/navigation\";\nimport { useMutation } from \"@tanstack/react-query\";\n\nimport { AppDispatch, RootState } from \"@/store\";\nimport {\n  addToConversations,\n  setLatestConversation,\n} from \"@/store/conversations\";\nimport { initiateConversation, followUser, unfollowUser } from \"@/api\";\nimport { fetchConnections } from \"@/store/connections\";\nimport { CustomError } from \"@/lib/helpers/class\";\nimport { errorToastWithCustomError } from \"@/lib/helpers/toast\";\nimport { selectConversationsData } from \"@/lib/selectors\";\n\ninterface JustFollowed {\n  [key: string]: boolean;\n}\n\nexport const useFollow = (handleCloseModal?: () => void) => {\n  const router = useRouter();\n  const { conversations } = useSelector((state: RootState) => ({\n    conversations: selectConversationsData(state),\n  }));\n  const dispatch = useDispatch<AppDispatch>();\n  const [justFollowed, setJustFollowed] = useState<JustFollowed>({});\n  const followMutation = useMutation({\n    mutationFn: (profileId: string) => followUser(profileId),\n    onSuccess: (data, profileId) => {\n      setJustFollowed((prevState) => ({\n        ...prevState,\n        [profileId]: true,\n      }));\n\n      dispatch(fetchConnections());\n    },\n    onError: (error: CustomError) => {\n      errorToastWithCustomError(error);\n    },\n  });\n  const unfollowMutation = useMutation({\n    mutationFn: (profileId: string) => unfollowUser(profileId),\n    onSuccess: (data, profileId) => {\n      setJustFollowed((prevState) => ({\n        ...prevState,\n        [profileId]: false,\n      }));\n\n      dispatch(fetchConnections());\n    },\n    onError: (error: CustomError) => {\n      errorToastWithCustomError(error);\n    },\n  });\n  const initiateConversationsMutation = useMutation({\n    mutationFn: (recipientId: string) => initiateConversation(recipientId),\n    onSuccess: (data) => {\n      const isExistingConversation = conversations.find((conversation) => {\n        return conversation.id === data.id;\n      });\n\n      if (isExistingConversation) {\n        dispatch(setLatestConversation(data.id));\n      } else {\n        dispatch(addToConversations(data));\n      }\n\n      setTimeout(() => {\n        router.push(\"/dashboard/messages\");\n      }, 2000);\n    },\n    onError: (error: CustomError) => {\n      errorToastWithCustomError(error);\n    },\n    onSettled: () => {\n      handleCloseModal && handleCloseModal();\n    },\n  });\n\n  const handleFollow = (profileId: string) => {\n    followMutation.mutate(profileId);\n  };\n\n  const handleUnfollow = (profileId: string) => {\n    unfollowMutation.mutate(profileId);\n  };\n\n  const handleInitiateConversations = (recipientId: string) => {\n    initiateConversationsMutation.mutate(recipientId);\n  };\n\n  return {\n    handleInitiateConversations,\n    handleFollow,\n    handleUnfollow,\n    justFollowed,\n  };\n};\n"]}